Index: squid/src/fs/aufs/store_dir_aufs.c
diff -c squid/src/fs/aufs/store_dir_aufs.c:1.40.2.8 squid/src/fs/aufs/store_dir_aufs.c:1.40.2.9
*** squid/src/fs/aufs/store_dir_aufs.c:1.40.2.8	Wed Aug  6 08:16:26 2003
--- squid/src/fs/aufs/store_dir_aufs.c	Wed Aug 25 15:07:25 2004
***************
*** 320,325 ****
--- 320,329 ----
      char *path;
      int fd;
      path = storeAufsDirSwapLogFile(sd, NULL);
+     if (aioinfo->swaplog_fd >= 0) {
+ 	debug(50, 1) ("storeAufsDirOpenSwapLog: %s already open\n", path);
+ 	return;
+     }
      fd = file_open(path, O_WRONLY | O_CREAT | O_BINARY);
      if (fd < 0) {
  	debug(50, 1) ("%s: %s\n", path, xstrerror());
***************
*** 963,968 ****
--- 967,976 ----
      state->new = xstrdup(storeAufsDirSwapLogFile(sd, ".clean"));
      state->fd = file_open(state->new, O_WRONLY | O_CREAT | O_TRUNC | O_BINARY);
      if (state->fd < 0) {
+ 	debug(50, 0) ("storeDirWriteCleanStart: %s: open: %s\n",
+ 	    state->new, xstrerror());
+ 	debug(50, 0) ("storeDirWriteCleanStart: Current swap logfile "
+ 	    "not replaced.\n");
  	xfree(state->new);
  	xfree(state);
  	return -1;
Index: squid/src/fs/ufs/store_dir_ufs.c
diff -c squid/src/fs/ufs/store_dir_ufs.c:1.39.2.9 squid/src/fs/ufs/store_dir_ufs.c:1.39.2.10
*** squid/src/fs/ufs/store_dir_ufs.c:1.39.2.9	Wed Jul 14 10:26:12 2004
--- squid/src/fs/ufs/store_dir_ufs.c	Wed Aug 25 15:07:25 2004
***************
*** 319,324 ****
--- 319,328 ----
      char *path;
      int fd;
      path = storeUfsDirSwapLogFile(sd, NULL);
+     if (ufsinfo->swaplog_fd >= 0) {
+ 	debug(50, 1) ("storeUfsDirOpenSwapLog: %s already open\n", path);
+ 	return;
+     }
      fd = file_open(path, O_WRONLY | O_CREAT | O_BINARY);
      if (fd < 0) {
  	debug(50, 1) ("%s: %s\n", path, xstrerror());
***************
*** 961,966 ****
--- 965,974 ----
      state->new = xstrdup(storeUfsDirSwapLogFile(sd, ".clean"));
      state->fd = file_open(state->new, O_WRONLY | O_CREAT | O_TRUNC | O_BINARY);
      if (state->fd < 0) {
+ 	debug(50, 0) ("storeDirWriteCleanStart: %s: open: %s\n",
+ 	    state->new, xstrerror());
+ 	debug(50, 0) ("storeDirWriteCleanStart: Current swap logfile "
+ 	    "not replaced.\n");
  	xfree(state->new);
  	xfree(state);
  	return -1;
