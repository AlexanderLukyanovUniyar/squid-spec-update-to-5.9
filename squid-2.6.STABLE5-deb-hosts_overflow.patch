#! /bin/sh /usr/share/dpatch/dpatch-run
## 52-hosts-overflow.dpatch by Luigi Gangitano <luigi@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad squid-2.6.5~/src/tools.c squid-2.6.5/src/tools.c
--- squid-2.6.5~/src/tools.c	2006-11-01 21:58:52.000000000 +0100
+++ squid-2.6.5/src/tools.c	2006-11-06 11:42:54.000000000 +0100
@@ -1,6 +1,6 @@
 
 /*
- * $Id: tools.c,v 1.249 2006/11/01 20:58:52 wessels Exp $
+ * $Id: tools.c,v 1.250 2006/11/04 17:09:45 hno Exp $
  *
  * DEBUG: section 21    Misc Functions
  * AUTHOR: Harvest Derived
@@ -1178,7 +1178,7 @@
 	    if (Config.appendDomain && !strchr(lt, '.')) {
 		/* I know it's ugly, but it's only at reconfig */
 		strncpy(buf2, lt, 512);
-		strncat(buf2, Config.appendDomain, 512 - strlen(lt));
+		strncat(buf2, Config.appendDomain, 512 - strlen(lt) - 1);
 		host = buf2;
 	    } else {
 		host = lt;
