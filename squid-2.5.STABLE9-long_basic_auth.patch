Index: squid/src/auth/basic/auth_basic.c
diff -c squid/src/auth/basic/auth_basic.c:1.14.2.8 squid/src/auth/basic/auth_basic.c:1.14.2.9
*** squid/src/auth/basic/auth_basic.c:1.14.2.8	Sat Sep 25 15:03:49 2004
--- squid/src/auth/basic/auth_basic.c	Fri Mar 18 17:15:29 2005
***************
*** 442,451 ****
       * Don't allow NL or CR in the credentials.
       * Oezguer Kesim <oec@codeblau.de>
       */
-     strtok(cleartext, "\r\n");
      debug(29, 9) ("authenticateBasicDecodeAuth: cleartext = '%s'\n", cleartext);
!     local_basic.username = xstrndup(cleartext, USER_IDENT_SZ);
!     xfree(cleartext);
      if ((cleartext = strchr(local_basic.username, ':')) != NULL)
  	*(cleartext)++ = '\0';
      local_basic.passwd = cleartext;
--- 442,455 ----
       * Don't allow NL or CR in the credentials.
       * Oezguer Kesim <oec@codeblau.de>
       */
      debug(29, 9) ("authenticateBasicDecodeAuth: cleartext = '%s'\n", cleartext);
!     if (strcspn(cleartext, "\r\n") != strlen(cleartext)) {
! 	debug(29, 1) ("authenticateBasicDecodeAuth: bad characters in authorization header '%s'\n",
! 	    proxy_auth);
! 	xfree(cleartext);
! 	return;
!     }
!     local_basic.username = cleartext;
      if ((cleartext = strchr(local_basic.username, ':')) != NULL)
  	*(cleartext)++ = '\0';
      local_basic.passwd = cleartext;
